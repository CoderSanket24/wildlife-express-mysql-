<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WildGuard Sanctuary - Visitor Feedbacks</title>
    <link rel="stylesheet" href="visitors-feedback.css">
</head>

<body>
    <div class="bg-animation"></div>

    <div class="container">
        <div class="header">
            <h1>WildGuard Sanctuary</h1>
            <p>Visitor Feedback & Reviews</p>
        </div>

        <div class="controls-bar">
            <a href="/" class="back-btn">‚Üê Back to Dashboard</a>
            <div class="filter-section">
                <button class="filter-btn active" onclick="filterFeedback('all')">All Feedback</button>
                <button class="filter-btn" onclick="filterFeedback('5-star')">5 Stars</button>
                <button class="filter-btn" onclick="filterFeedback('4-star')">4 Stars</button>
                <button class="filter-btn" onclick="filterFeedback('recent')">Recent</button>
            </div>
        </div>

        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number"><%= totalFeedbacks %></div>
                <div class="stat-label">Total Reviews</div>
            </div>
            <div class="stat-card">
                <div class="stat-number"><%= averageRating %></div>
                <div class="stat-label">Average Rating</div>
            </div>
            <div class="stat-card">
                <div class="stat-number"><%= recommendRatingPercentage %>%</div>
                <div class="stat-label">Recommend Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-number"><%= thisMonthFeedbacks %></div>
                <div class="stat-label">This Month</div>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Search feedback by name, booking ID, or comments..."
                oninput="searchFeedback(this.value)">
        </div>

        <div class="feedback-grid" id="feedbackGrid">
            <%feedbacks.forEach(feedback=> {%>
                <div class="feedback-card" data-rating="3" data-date="2025-01-17">
                    <div class="feedback-header">
                        <div class="visitor-info">
                            <div class="visitor-name">
                                <%= feedback.name %>
                            </div>
                            <div class="visit-date">
                                <%=new Date(feedback.visit_date).toLocaleDateString('en-US', { year: 'numeric' ,
                                    month: 'long' , day: 'numeric' })%>
                            </div>
                        </div>
                        <div class="booking-id">
                            <%= feedback.ticket_id %>
                        </div>
                    </div>

                    <div class="rating-section">
                        <div class="rating-row">
                            <span class="rating-label">Overall Experience:</span>
                            <div class="stars">
                                <%for(let i=0; i < feedback.rating_overall; i++) {%>
                                    <span class="star">‚òÖ</span>
                                    <%}%>
                                        <%for(let i=feedback.rating_overall; i < 5; i++) {%>
                                            <span class="star empty">‚òÖ</span>
                                            <%}%>
                            </div>
                        </div>
                        <div class="rating-row">
                            <span class="rating-label">Guide Service:</span>
                            <div class="stars">
                                <%for(let i=0; i < feedback.rating_guide; i++) {%>
                                    <span class="star">‚òÖ</span>
                                    <%}%>
                                        <%for(let i=feedback.rating_guide; i < 5; i++) {%>
                                            <span class="star empty">‚òÖ</span>
                                            <%}%>
                            </div>
                        </div>
                        <div class="rating-row">
                            <span class="rating-label">Facilities:</span>
                            <div class="stars">
                                <%for(let i=0; i < feedback.rating_facility; i++) {%>
                                    <span class="star">‚òÖ</span>
                                    <%}%>
                                        <%for(let i=feedback.rating_facility; i < 5; i++) {%>
                                            <span class="star empty">‚òÖ</span>
                                            <%}%>
                            </div>
                        </div>
                    </div>

                    <div class="wildlife-tags">
                        <%for(let tag of feedback.sightings) {%>
                            <span class="tag">
                                <%= tag %>
                            </span>
                            <%}%>
                    </div>

                    <div class="feedback-comment">
                        <%= feedback.comments %>
                    </div>

                    <% if (feedback.recommend==='maybe' ) { %>
                        <div class="recommendation-badge recommend-maybe">
                            ü§î Maybe Recommends
                        </div>
                        <% }else if (feedback.recommend==='yes' ) { %>
                            <div class="recommendation-badge recommend-yes">
                                ‚úÖ Definitely Recommends
                            </div>
                            <% }else { %>
                                <div class="recommendation-badge recommend-no">
                                    ‚ùå Does Not Recommend
                                </div>
                                <% } %>
                </div>
                <%})%>


        </div>

        <div class="no-results" id="noResults" style="display: none;">
            No feedback found matching your search criteria.
        </div>
    </div>

    <script>
        // Create floating leaves animation
        function createFloatingLeaf() {
            const leaf = document.createElement('div');
            leaf.className = 'floating-leaf';
            leaf.innerHTML = Math.random() > 0.5 ? 'üçÉ' : 'üåø';
            leaf.style.left = Math.random() * 100 + '%';
            leaf.style.animationDelay = Math.random() * 5 + 's';
            leaf.style.animationDuration = (Math.random() * 4 + 6) + 's';

            document.querySelector('.bg-animation').appendChild(leaf);

            setTimeout(() => {
                if (leaf.parentNode) {
                    leaf.parentNode.removeChild(leaf);
                }
            }, 10000);
        }

        setInterval(createFloatingLeaf, 2000);
        for (let i = 0; i < 5; i++) {
            setTimeout(createFloatingLeaf, i * 500);
        }

        // Filter feedback
        function filterFeedback(filterType) {
            const cards = document.querySelectorAll('.feedback-card');
            const filterBtns = document.querySelectorAll('.filter-btn');
            let visibleCount = 0;

            // Update active button
            filterBtns.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            cards.forEach(card => {
                let show = false;
                const rating = parseInt(card.getAttribute('data-rating'));

                switch (filterType) {
                    case 'all':
                        show = true;
                        break;
                    case '5-star':
                        show = rating === 5;
                        break;
                    case '4-star':
                        show = rating === 4;
                        break;
                    case 'recent':
                        const cardDate = new Date(card.getAttribute('data-date'));
                        const weekAgo = new Date();
                        weekAgo.setDate(weekAgo.getDate() - 7);
                        show = cardDate >= weekAgo;
                        break;
                }

                if (show) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Show/hide no results message
            document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
        }

        // Search feedback
        function searchFeedback(searchTerm) {
            const cards = document.querySelectorAll('.feedback-card');
            const term = searchTerm.toLowerCase().trim();
            let visibleCount = 0;

            if (term === '') {
                cards.forEach(card => {
                    card.style.display = 'block';
                    visibleCount++;
                });
            } else {
                cards.forEach(card => {
                    const name = card.querySelector('.visitor-name').textContent.toLowerCase();
                    const bookingId = card.querySelector('.booking-id').textContent.toLowerCase();
                    const comment = card.querySelector('.feedback-comment').textContent.toLowerCase();

                    if (name.includes(term) || bookingId.includes(term) || comment.includes(term)) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            // Show/hide no results message
            document.getElementById('noResults').style.display = visibleCount === 0 ? 'block' : 'none';
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; 
                background: ${type === 'success' ? 'rgba(76, 175, 80, 0.9)' : 'rgba(244, 67, 54, 0.9)'}; 
                color: white; padding: 15px 20px; border-radius: 10px; 
                z-index: 1001; font-weight: bold;
                transform: translateX(300px); transition: transform 0.3s ease;
                max-width: 250px; backdrop-filter: blur(10px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                notification.style.transform = 'translateX(300px)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Welcome notification
        setTimeout(() => {
            showNotification('Displaying all visitor feedback');
        }, 1000);

        // Add click event to feedback cards for detailed view
        document.querySelectorAll('.feedback-card').forEach(card => {
            card.addEventListener('click', function () {
                this.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 200);
            });
        });
    </script>
</body>

</html>